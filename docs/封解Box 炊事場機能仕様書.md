# **封解Box 炊事場機能仕様書**

**バージョン**: 1.0

**対象システム**: 封解Box (fukaibox.kanjousekai.jp)

**モジュール**: 炊事場（Cooking Module）

## **1\. 概要**

「封解Box 炊事場」は、動画制作における企画、台本作成（調理）、素材収集、評価、および外部プラットフォーム（Wiki, YouTube）への公開・予約を一元管理するワークフローシステムである。  
儀長（管理者）と儀員（貢献者）のロールに基づいた共同作業環境を提供する。

## **2\. ユーザーロールと権限**

| ロール | 権限概要 |
| :---- | :---- |
| **儀長** (Admin) | ・料理（プロジェクト）の新規作成、開始 ・台本の推敲確定、提案の承認/非承認 ・画像の最終採用判定 ・成果物のダウンロード ・外部連携（Wiki反映、YouTube予約）の実行 |
| **儀員** (Member) | ・推敲案の提案 ・画像のアップロード（参考・素材） ・アーカイブのGoogle Drive保存 ・自身の評価点（儀員点数）の獲得 |
| **名誉儀員** | ・儀員権限に準ずる（※フロー上は儀員と同様の動線だが、特定の表示待遇がある可能性あり） |
| **ゲスト** | ・閲覧権限のみ（待機画面） |

## **3\. 機能要件詳細**

### **3.1 料理（プロジェクト）管理**

**アクセス**: ホーム画面サイドバー \> 「封解Box 炊事場」

* **料理一覧画面**:  
  * 既存の料理プロジェクトを表示。  
  * **新規作成**: 儀長のみ実行可能。「儀長が料理開始」アクションにより、新規プロジェクトが立ち上がる。

### **3.2 調理プロセス（台本作成フェーズ）**

**画面**: 調理タブ

1. **セクション管理機能**:  
   * 儀長は台本を任意の「セクション」に分割して管理する。  
   * 各セクションに対し、以下の設定が可能。  
     * **画像指示**: どのような画像が必要かのテキスト指示。  
     * **参考画像UP**: イメージ共有のための画像アップロード。  
     * **画像提出可否設定**: 儀長は特定のセクションを「画像提出不可（テキストのみ等）」に設定可能。  
2. **推敲（ライティング）機能**:  
   * **儀長**: ベースとなるテキストを作成・編集する。  
   * **儀員**: 既存テキストに対し「推敲提案」を行うことができる。  
   * **承認フロー**: 儀長は儀員からの提案に対し「承認」または「非承認」を選択する。承認された内容は本文に反映される。  
3. **AI評価システム**:  
   * **トリガー**: 調理（推敲）完了時、または任意のタイミング。  
   * **使用モデル**: **GLM-4.6V-Flash**  
   * **機能**: ショート動画の台本として、第三者視点から評価を行う。  
   * **出力項目**:  
     * 採点: 100点満点（厳しめ）。  
     * 評価視点: 5つの視点から分析。  
     * 指標: 「4秒で引きつけられるか」「セクションごとのテンポは良いか」「動画の伸び度（予測）」など。

### **3.3 画像収集プロセス**

**画面**: 画像upタブ

* **アップロード機能**:  
  * セクションごとに画像をアップロード可能。  
  * **アセットレジストリ連携**: 外部ファイルだけでなく、システム内の「アセットレジストリ」から既存画像を引用・紐付けすることも可能。  
* **インセンティブ**:  
  * 画像をアップロードするごとに、当該儀員の「儀員点数」が加算される（点数ロジックはAPI仕様に準拠）。  
* **完了判定**:  
  * 儀長が画像の集まり具合を判断し、次のフェーズ（画像採用）へ移行する。

### **3.4 画像採用プロセス**

**画面**: 画像採用タブ

* **選定機能**:  
  * 儀長はセクションごとに、アップロードされた画像の中から「暫定採用」画像を選定する（複数選択可能）。  
* **可視化**:  
  * 儀員は、どの画像が暫定採用されているかを確認できる。  
* **インセンティブ**:  
  * 自身の画像が採用されるごとに、当該儀員の「儀員点数」がさらに加算される。

### **3.5 成果物出力とアーカイブ**

**画面**: ダウンロードタブ

* **ダウンロード**: 儀長のみ実行可能。完成した台本データおよび採用画像セットを一括ダウンロードする。  
* **アーカイブ**:  
  * ダウンロード完了後、プロジェクトは「料理アーカイブ」へ移行。  
  * **Google Drive連携**: 儀員はアーカイブされたデータを自身のGoogle Driveへ保存可能。

## **4\. 外部システム連携・自動化フロー**

### **4.1 情報反映（Wiki・事典・素材記録）**

**トリガー**: 「情報反映ボタン」の押下（儀長操作）

1. **環状世界Wiki連携**:  
   * **URL**: https://kanjou.miraheze.org/wiki/封解公儀:原稿/\[年\]/\[月\]  
   * **動作**: 完成した原稿データを上記ページの指定パスへ自動的に書き込む。  
2. **界域百科事典連携**:  
   * **使用モデル**: **GLM-4.6V-Flash**  
   * **動作**: 台本の内容を解析し、重要な単語を抽出して「界域百科事典」データベースへ自動追加する。  
3. **使用素材記録**:  
   * **選定**: 儀長が最終的に採用する画像を確定させる（新規UPも可）。  
   * **AI解析**: **GLM-4.6V-Flash**が画像を解析し、各画像に適切な名前（ファイル名/キャプション）を自動付与する。  
   * **承認**: AIが付けた名前を儀長が確認・承認する。  
   * **Wiki書込**: https://kanjou.miraheze.org/wiki/封解公儀:使用素材/\[年\]/\[月\] へ使用素材リストを自動書き込みする。

### **4.2 YouTube連携（YoutubeManager）**

**トリガー**: アーカイブ後の「投稿予約ボタン」押下

1. **予約投稿**:  
   * 儀長が日付を指定し、動画ファイルをアップロードする。  
   * システムがYouTube APIを通じて自動予約を行う。  
2. **重複回避ロジック（Conflict Resolution）**:  
   * **判定**: 指定した日付に既に予約が存在するかチェック。  
   * **動作**:  
     * Yes（重複あり）: 元々その日に予定されていた予約を**自動的に「1つ後ろ（翌日等）」へシフト**させる。  
     * このシフト処理は、重複が解消されるまで再帰的に行われる可能性がある。  
   * **完了**: 予約完了通知を発行する。

## **5\. 関連API仕様（参照）**

### **儀員点数API**

* **概要**: ユーザーの貢献度（点数）を管理する独立したサービス。本体（封解Box）とは切り離されたスタンドアローン構成。  
* **エンドポイント機能**:  
  * ヘルスチェック  
  * 点数取得 / 順位取得 / 順位からユーザー取得  
  * 点数の増減（認証キー必須）  
* **管理画面**: AdminPanelにて履歴確認、点数手動操作、ユーザー追放などが可能。