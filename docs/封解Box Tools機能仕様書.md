# **封解Box Tools機能仕様書**

**バージョン**: 0.1 (Draft)
**対象システム**: 封解Box (fukaibox.kanjousekai.jp)
**モジュール**: Tools (App Platform)

## **1. 概要**

「封解Box Tools」は、封解公儀の儀員が利用できる**AI主導型アプリケーションプラットフォーム**である。
ユーザーは「Tools工房」にてAI（Qwen3/GLM-4）と対話しながら、React/HTMLベースのマイクロアプリ（App）を即座に生成・公開できる。
公開されたAppは「App Gallery」に並び、他の儀員が実行・評価することができる。

## **2. ユーザーロールと権限**

| ロール | Tools工房 (作成) | Gallery (利用) | 評価・コメント | 管理 |
| :---- | :---: | :---: | :---: | :---: |
| **儀長** | ○ (無制限) | ○ | ○ | 全App管理・削除 |
| **儀員** | ○ (クレジット制) | ○ | ○ | 自身のApp管理 |
| **名誉儀員**| ○ (クレジット優遇) | ○ | ○ | 自身のApp管理 |
| **ゲスト** | × | △ (公開Appのみ) | × | × |

## **3. 機能要件詳細**

### **3.1 Tools工房 (App Studio)**

**コンセプト**: "Prompt to App" - 自然言語で欲しいツールを説明するだけで、動くアプリが生成される。

- **アクセス**: ホーム画面サイドバー最下部「封解Box Tools」よりアクセス。
- **UIレイアウト**:
  - **左パネル**: AIチャットインターフェース（OpenRouter経由）。
  - **右パネル**: プレビュー画面 / コードエディタ（タブ切り替え）。
  - **ファイルツリー**: 複数ファイル（React/HTML）の管理に対応。

- **生成プロセス**:
  1. **クレジット確認**: AI生成機能の使用前に所持クレジットを確認。
  2. **プロンプト入力**: ユーザーが作りたいアプリを説明。
  3. **AI生成**: AI がコードを生成。
  4. **プレビュー**: 生成されたコードを即座にレンダリング。
  5. **保存・公開**: 作成したアプリをToolsに保存し、公開設定を行う。

### **3.2 Tools Gallery & Runtime**

**コンセプト**: アプリの共有と実行の場。

- **一覧表示**: カテゴリ別、新着順、人気順などで表示。
- **実行環境**:
  - **モーダル実行**: 通常のアプリ利用モード。
  - **右サイドバー実行**: 作業しながらの利用（例：計算機、メモなど）に対応。
- **評価機能**:
  - 高評価 / 低評価
  - コメント投稿機能

## **4. データ構造 (Supabase)**

Tools機能は、App生成時の大量のファイルやリアルタイム性を考慮し、メインのTursoとは別に**Supabase**を使用する。コード自体はTursoに保存する。

### **Tables**

- `tools_apps`: Appのメタデータ（タイトル、説明、作者、公開設定、カテゴリ）。
- `tools_files`: Appを構成するソースコード（バージョン管理含む）。
- `tools_ratings`: ユーザーによる評価（High/Low）とコメント。
- `tools_credits`: ユーザーの残りクレジット残高。

## **5. 技術スタック**

- **Frontend**: Next.js, HeroUI, Lucide React
- **Editor/Preview**: CodeMirror / @monaco-editor/react, Sandpack
- **Backend DB**: Supabase (PostgreSQL)
- **AI**: OpenRouter API
